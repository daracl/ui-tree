<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Dara tree</title>
  <meta http-equiv="X-UA-compatible" content="IE=edge">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
</head>


</HEAD>

<body onload="load()">
  <div class="daracl-main" style="height:700px;">
    <h2 class="page-header">트리</h2>
    <div>
      <table style="width:100%;height:100%;table-layout: fixed;border:1px solid #dddddd">
        <tr valign="top">
          <td style="width:50%;">
            <div class="button-area">
              <button type="button" onclick="init()">init</button>
              ||
              <button type="button" onclick="treeOpen()">오픈</button>
              ||
              <button type="button" onclick="treeClose()">닫기</button>
              ||
              <button type="button" onclick="removeSelectNode()">선택 노드 삭제</button>
              ||
              <button type="button" onclick="addChildNode()">선택 노드에 하위 노드 추가</button>
            </div>
            <div>
              <input type="text" placeholder="Search" class="node-search"/>
            </div>
            <div id="treeDiv" style="overflow:auto;height:500px"></div>

            <br />

          </td>
          <td style="width:50%;">
            <div id="logView" style="height: 100%;overflow:auto;"></div>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class="my-div" tabindex="0" onblur="handleBlur()">
    Click here and then click outside to trigger blur event
  </div>

  <script>
    function handleBlur() {
      console.log('The div lost focus');
    }
  </script>
</body>

</html>
<style>
  .form-button {
    text-align: center;
  }

  :root {
    --bg: #ffffff;
    --bg-color: #070d19;

  }

  body.dark {
    --bg: #070d19;
    --bg-color: #ffffff;

  }

  body {
    background-color: var(--bg);
  }

  .header {
    color: var(--bg-color);
  }
</style>
<script>

  const THEME_KEY = "form-theme";
  const theme = localStorage.getItem(THEME_KEY);

  if (theme) setMainTheme(theme);

  function setMainTheme(theme, persist) {
    const classList = document.body.classList;

    classList.remove("light", "dark");

    classList.add(theme);

    if (persist) {
      localStorage.setItem(THEME_KEY, theme);
    }
  }

  function load() {
    // theme
    const toggler = document.querySelectorAll('[name="theme-toggle"]');
    const theme = localStorage.getItem(THEME_KEY);

    if (toggler) {
      if (theme === "dark") {
        document.querySelector('[name="theme-toggle"][value="dark"]').checked = true;
      }
    }

    document.querySelectorAll(".node-search").forEach((input) => {
        input.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            const value = this.value.trim();
            treeObj.search(value);
          }
        });
      });

    init()
  }
  var logViewElement = document.getElementById('logView');
  function logView() {
    console.log(arguments);

    return;
    const pElement = document.createElement('p'); // 새로운 <p> 요소 생성

    var logText = [];

    for (var idx in arguments) {
      var log = arguments[idx];
      logText.push(JSON.stringify(log, function (key, value) {
        if (key === 'config') {
          return undefined; // 부모 객체를 제외
        }
        return value;
      }));
    }

    pElement.textContent = logText.join(' '); // 텍스트 내용 설정
    logViewElement.appendChild(pElement);


    //logViewElement.insertAdjacentHTML('beforeend', `<div>${}</div>`);
  }

  var treeObj;

  function init() {

    var treeItem = JSON.parse(document.getElementById("sourceSample").textContent);

    treeObj = Daracl.tree.create("#treeDiv", {
      items: treeItem
      , style: {
        height: 300
      }
      //"root"
      , rootNode: {
        id: ""
        , text: 'root node'
      }
      , nodeStyleClass(node) {
        //console.log(node);
        return node.id == "1" ? "id-1" : "222";
      }
      , enableRootNode1: true
      , enableIcon: true
      , openDepth: 0
      , plugins: {
        checkbox: {}
        , edit: {
          before: function (item) {
            console.log(item)
            //return false;
          }
          , after: function (item) {
            console.log(item)
            //return 'asdfawef';
          }
        }
        , dnd: {
          drop: function (item) {
            console.log('item ', item);
          }
        }
        , request1: {
          searchNode: function (node) {

            fetch('/data/tree-node.json?id=${node.id}&pid=' + node.pid, {
              method: 'get', data: node
            })
              .then(function (response) {
                return response.json();
              })
              .then(function (data) {

                const nodeData = [];


                for (let idx in data) {
                  var item = data[idx];

                  if (item.pid == node.id) {
                    if (item.state) {
                      item.state.folder = true;
                    } else {
                      item.state = { folder: true }
                    }
                    nodeData.push(item);
                  }
                }
                treeObj.addNode(nodeData)
              })
              .catch(function (error) {
                console.log(error)
              });

          }
          , removeNode: function (node) {
            console.log('removeNode ', node)

          }
          , modifyNode: function (node) {
            console.log('modifyNode ', node)
          }
          , createNode: function (node) {
            treeObj.getNodeInfo(node.id).setEdit();
            console.log(node);
            //console.log('createNode ', node)
          }
        }
      }
      , click: function (nodeInfo) {
        console.log('click', nodeInfo)
      }
      , dblclick: function (nodeInfo) {
        console.log('dblclick', nodeInfo)
        //return false;
      }
      , selectNode: function (nodeInfo) {
        console.log('selectNode', nodeInfo)
      }

    });
  }


  window.treeObj = treeObj;

  function addChildNode() {
    const selectNode = treeObj.getSelectNode();

    if (selectNode) {
      const addItems = getAddItem(selectNode.id);
      treeObj.addNode(addItems);
    }
  }

  let addNodeIdx = 0;
  const addNodePrefix = 'addNode_';
  function getAddItem(nodeId, depth) {
    depth = depth || 1;
    let addItems = [];
    addItems.push({ id: addNodePrefix + (++addNodeIdx), pid: nodeId, text: nodeId + ' new item ' + addNodeIdx, url: "detail('2')" });

    return addItems;
  }

  function treeOpen() {
    window.treeObj.allOpen();
  }

  function treeClose() {
    window.treeObj.allClose();
  }


  function removeSelectNode(obj) {
    const selectNode = treeObj.getSelectNode();
    if (selectNode) treeObj.remove(selectNode.id);
  }

  function createNode() {
    treeObj.createNode();
  }

  function saveInfo() {

    // $.pubTree("#treeDiv").addNode((pubTreeConfig.allTreeItem.length + 100), pubTreeConfig.selectedNode.id, document.getElementById('name').value, document.getElementById('url').value)
  }


</script>
<script id="sourceSample" type="text/content">
  [
  
  { "id": 0, "pid": "", "text": "Root Menu 1", "url": "detail('0')" },
  { "id": 1, "pid": 0, "text": "한글임 1.1", "url": "detail('1')" },
  { "id": 2, "pid": 0, "text": "한글임 1.2", "url": "detail('2')" },
  { "id": 3, "pid": 1, "text": "한글임 1.1.1", "url": "detail('3')" },
  { "id": 4, "pid": 1, "text": "한글임 1.1.2", "url": "detail('4')" },
  { "id": 5, "pid": 2, "text": "한글임 1.2.1", "url": "detail('5')" },
  { "id": 6, "pid": "", "text": "Root Menu 2", "url": "detail('6')" },
  { "id": 7, "pid": 0, "text": "한글임 2.1", "url": "detail('7')" },
  { "id": 8, "pid": 0, "text": "한글임 2.2", "url": "detail('8')" },
  { "id": 9, "pid": 7, "text": "한글임 2.1.1", "url": "detail('9')" },
  { "id": 10, "pid": 7, "text": "한글임 2.1.2", "url": "detail('10')" },
  { "id": 11, "pid": 8, "text": "Sub Menu 2.2.1", "url": "detail('11')" },
  { "id": 12, "pid": "", "text": "Root Menu 3", "url": "detail('12')" },
  { "id": 13, "pid": 12, "text": "Sub Menu 3.1", "url": "detail('13')" },
  { "id": 14, "pid": 12, "text": "Sub Menu 3.2", "url": "detail('14')" },
  { "id": 15, "pid": 13, "text": "Sub Menu 3.1.1", "url": "detail('15')" },
  { "id": 16, "pid": 13, "text": "Sub Menu 3.1.2", "url": "detail('16')" },
  { "id": 17, "pid": 14, "text": "Sub Menu 3.2.1", "url": "detail('17')" },
  { "id": 18, "pid": 14, "text": "Sub Menu 3.2.2", "url": "detail('18')" },
  { "id": 19, "pid": 18, "text": "Sub Menu 3.2.2.1", "url": "detail('19')" },
  { "id": 20, "pid": "", "text": "Root Menu 4", "url": "detail('20')" },
  { "id": 21, "pid": 20, "text": "Sub Menu 4.1", "url": "detail('21')" },
  { "id": 22, "pid": 20, "text": "Sub Menu 4.2", "url": "detail('22')" },
  { "id": 23, "pid": 21, "text": "Sub Menu 4.1.1", "url": "detail('23')" },
  { "id": 24, "pid": 21, "text": "Sub Menu 4.1.2", "url": "detail('24')" },
  { "id": 25, "pid": 22, "text": "Sub Menu 4.2.1", "url": "detail('25')" },
  { "id": 26, "pid": "", "text": "Root Menu 5", "url": "detail('26')" },
  { "id": 27, "pid": 26, "text": "Sub Menu 5.1", "url": "detail('27')" },
  { "id": 28, "pid": 27, "text": "Sub Menu 5.1.1", "url": "detail('28')" },
  { "id": 29, "pid": 27, "text": "Sub Menu 5.1.2", "url": "detail('29')" }
]
</script>